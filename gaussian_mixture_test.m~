%% choose k for GMM

gm_models = cell

%% test Gaussian Mixture 
close all

X_s = X_selected;
%X_s = X_train_imagefea_cont;
GMModel = fitgmdist(X_s,2,'Start', 'plus','RegularizationValue',0.1);
 = [0.4,0.6];
P = posterior(GMModel,X_s);

n = size(X_s,1);
[~,order]= sort(P(:,1));
%%

figure;
plot(1:n,P(order,1),'r-',1:n,P(order,2),'b-');
legend({'Cluster 1', 'Cluster 2'});
ylabel('Cluster Membership Score');
xlabel('Point Ranking');
title('GMM with Full Unshared Covariances');

%%
idx = cluster(GMModel,X_s);
idxBoth = find(P(:,1)>=threshold(1) & P(:,1)<=threshold(2));
numInBoth = numel(idxBoth)

figure;
gscatter(X_s(:,1),X_s(:,2),idx,'rb','+o',5);
hold on;
plot(X_s(idxBoth,1),X_s(idxBoth,2),'ko','MarkerSize',10);
legend({'Cluster 1','Cluster 2','Both Clusters'},'Location','SouthEast');
title('Scatter Plot - GMM with Full Unshared Covariances')
hold off;